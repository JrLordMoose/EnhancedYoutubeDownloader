<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:EnhancedYoutubeDownloader.ViewModels.Dialogs"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="700"
             x:Class="EnhancedYoutubeDownloader.Views.Dialogs.SettingsDialog"
             x:DataType="vm:SettingsViewModel"
             Width="600" Height="700">

    <Design.DataContext>
        <vm:SettingsViewModel />
    </Design.DataContext>

    <Border Background="{DynamicResource MaterialDesignPaper}"
            CornerRadius="8"
            Padding="0"
            BoxShadow="0 8 16 0 #40000000">

        <Grid RowDefinitions="Auto,*,Auto">

            <!-- Header -->
            <Border Grid.Row="0"
                    Background="{DynamicResource MaterialDesignCardBackground}"
                    BorderBrush="{DynamicResource MaterialDesignDivider}"
                    BorderThickness="0,0,0,1"
                    Padding="20,16">
                <TextBlock Text="Settings"
                          FontSize="18"
                          FontWeight="SemiBold"/>
            </Border>

            <!-- Content -->
            <ScrollViewer Grid.Row="1"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Disabled">
                <TabControl Margin="0" Padding="0">

                <!-- General Tab -->
                <TabItem Header="General">
                    <Border Padding="20,16">
                        <StackPanel Spacing="20">

                            <!-- Theme Setting -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Appearance"
                                          FontSize="14"
                                          FontWeight="Medium"/>
                                <Grid ColumnDefinitions="*,200">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="Theme"
                                                  FontSize="14"/>
                                        <TextBlock Text="Choose your preferred color scheme"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <ComboBox Grid.Column="1"
                                             SelectedIndex="{Binding Settings.Theme, Mode=TwoWay}"
                                             HorizontalAlignment="Stretch"
                                             VerticalAlignment="Center"
                                             Theme="{DynamicResource MaterialFilledComboBox}">
                                        <ComboBoxItem Content="Auto (System)"/>
                                        <ComboBoxItem Content="Light"/>
                                        <ComboBoxItem Content="Dark"/>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>

                            <Separator Background="{DynamicResource MaterialDesignDivider}"/>

                            <!-- Auto-update Setting -->
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel Grid.Column="0" Spacing="4">
                                    <TextBlock Text="Automatic Updates"
                                              FontSize="14"/>
                                    <TextBlock Text="Check for updates on startup"
                                              FontSize="12"
                                              Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                </StackPanel>
                                <ToggleSwitch Grid.Column="1"
                                             IsChecked="{Binding Settings.IsAutoUpdateEnabled, Mode=TwoWay}"
                                             VerticalAlignment="Center"/>
                            </Grid>

                        </StackPanel>
                    </Border>
                </TabItem>

                <!-- Downloads Tab -->
                <TabItem Header="Downloads">
                    <Border Padding="20,16">
                        <StackPanel Spacing="16">

                            <!-- Parallel Downloads -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Performance"
                                          FontSize="14"
                                          FontWeight="Medium"/>
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="Parallel Downloads"
                                                  FontSize="14"/>
                                        <TextBlock Text="Maximum number of simultaneous downloads"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <TextBlock Grid.Column="1"
                                              Text="{Binding Settings.ParallelLimit}"
                                              FontSize="19"
                                              VerticalAlignment="Center"
                                              Margin="0,0,16,0"/>
                                </Grid>
                                <Slider Value="{Binding Settings.ParallelLimit, Mode=TwoWay}"
                                       Minimum="1"
                                       Maximum="10"
                                       TickFrequency="1"
                                       IsSnapToTickEnabled="True"
                                       Margin="0,8,0,0"/>
                            </StackPanel>

                            <Separator Background="{DynamicResource MaterialDesignDivider}"/>

                            <!-- Default Quality -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Default Settings"
                                          FontSize="14"
                                          FontWeight="Medium"/>
                                <Grid ColumnDefinitions="*,200" RowDefinitions="Auto,Auto" RowSpacing="16">
                                    <!-- Quality -->
                                    <StackPanel Grid.Row="0" Grid.Column="0" Spacing="4">
                                        <TextBlock Text="Default Quality"
                                                  FontSize="14"/>
                                        <TextBlock Text="Preferred video quality"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <ComboBox Grid.Row="0" Grid.Column="1"
                                             SelectedIndex="{Binding Settings.DefaultQuality, Mode=TwoWay}"
                                             HorizontalAlignment="Stretch"
                                             VerticalAlignment="Center"
                                             Theme="{DynamicResource MaterialFilledComboBox}">
                                        <ComboBoxItem Content="Best Quality"/>
                                        <ComboBoxItem Content="1080p"/>
                                        <ComboBoxItem Content="720p"/>
                                        <ComboBoxItem Content="480p"/>
                                    </ComboBox>

                                    <!-- Format -->
                                    <StackPanel Grid.Row="1" Grid.Column="0" Spacing="4">
                                        <TextBlock Text="Default Format"
                                                  FontSize="14"/>
                                        <TextBlock Text="Preferred video format"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <ComboBox Grid.Row="1" Grid.Column="1"
                                             SelectedIndex="{Binding Settings.DefaultFormat, Mode=TwoWay}"
                                             HorizontalAlignment="Stretch"
                                             VerticalAlignment="Center"
                                             Theme="{DynamicResource MaterialFilledComboBox}">
                                        <ComboBoxItem Content="MP4"/>
                                        <ComboBoxItem Content="WebM"/>
                                        <ComboBoxItem Content="MP3"/>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>

                            <Separator Background="{DynamicResource MaterialDesignDivider}"/>

                            <!-- Injection Settings -->
                            <StackPanel Spacing="16">
                                <TextBlock Text="Content Options"
                                          FontSize="14"
                                          FontWeight="Medium"/>

                                <!-- Subtitles -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="Download Subtitles"
                                                  FontSize="14"/>
                                        <TextBlock Text="Include subtitle tracks by default"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1"
                                                 IsChecked="{Binding Settings.ShouldInjectSubtitles, Mode=TwoWay}"
                                                 VerticalAlignment="Center"/>
                                </Grid>

                                <!-- Subtitle Style -->
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,200">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="Subtitle Style"
                                                      FontSize="14"/>
                                            <TextBlock Text="How subtitles are displayed in videos"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                        </StackPanel>
                                        <ComboBox Grid.Column="1"
                                                 SelectedIndex="{Binding Settings.SubtitleStyle, Mode=TwoWay}"
                                                 HorizontalAlignment="Stretch"
                                                 VerticalAlignment="Center"
                                                 Theme="{DynamicResource MaterialFilledComboBox}">
                                            <ComboBoxItem Content="Embedded (Basic)" Tag="0"/>
                                            <ComboBoxItem Content="Burned-In (Styled)" Tag="1"/>
                                            <ComboBoxItem Content="External File (.ass)" Tag="2"/>
                                        </ComboBox>
                                    </Grid>
                                </StackPanel>

                                <!-- Subtitle Font Size -->
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="Font Size"
                                                      FontSize="14"/>
                                            <TextBlock Text="Size of burned-in subtitle text"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="1"
                                                  Text="{Binding Settings.SubtitleFontSize}"
                                                  FontSize="19"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,16,0"/>
                                    </Grid>
                                    <Slider Value="{Binding Settings.SubtitleFontSize, Mode=TwoWay}"
                                           Minimum="16"
                                           Maximum="48"
                                           TickFrequency="2"
                                           IsSnapToTickEnabled="True"
                                           Margin="0,8,0,0"/>
                                </StackPanel>

                                <!-- Subtitle Background Opacity -->
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="Background Opacity"
                                                      FontSize="14"/>
                                            <TextBlock Text="Opacity of subtitle background box (0-100%)"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="1"
                                                  Text="{Binding Settings.SubtitleBackgroundOpacity, StringFormat='{}{0:P0}'}"
                                                  FontSize="19"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,16,0"/>
                                    </Grid>
                                    <Slider Value="{Binding Settings.SubtitleBackgroundOpacity, Mode=TwoWay}"
                                           Minimum="0.0"
                                           Maximum="1.0"
                                           TickFrequency="0.05"
                                           IsSnapToTickEnabled="True"
                                           Margin="0,8,0,0"/>
                                </StackPanel>

                                <!-- AI Subtitles -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="AI Subtitle Generation (Experimental)"
                                                  FontSize="14"/>
                                        <TextBlock Text="Generate subtitles using AI when not available"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1"
                                                 IsChecked="{Binding Settings.EnableAISubtitles, Mode=TwoWay}"
                                                 VerticalAlignment="Center"/>
                                </Grid>

                                <!-- AI Subtitle Language (visible only when AI subtitles enabled) -->
                                <StackPanel Spacing="8" IsVisible="{Binding Settings.EnableAISubtitles}">
                                    <Grid ColumnDefinitions="*,200">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="AI Subtitle Language"
                                                      FontSize="14"/>
                                            <TextBlock Text="Language for AI-generated subtitles"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                        </StackPanel>
                                        <ComboBox Grid.Column="1"
                                                 SelectedIndex="0"
                                                 HorizontalAlignment="Stretch"
                                                 VerticalAlignment="Center"
                                                 Theme="{DynamicResource MaterialFilledComboBox}">
                                            <ComboBoxItem Content="Auto-detect" Tag="auto"/>
                                            <ComboBoxItem Content="English" Tag="en"/>
                                            <ComboBoxItem Content="Spanish" Tag="es"/>
                                            <ComboBoxItem Content="French" Tag="fr"/>
                                            <ComboBoxItem Content="German" Tag="de"/>
                                            <ComboBoxItem Content="Italian" Tag="it"/>
                                            <ComboBoxItem Content="Portuguese" Tag="pt"/>
                                            <ComboBoxItem Content="Japanese" Tag="ja"/>
                                            <ComboBoxItem Content="Korean" Tag="ko"/>
                                            <ComboBoxItem Content="Chinese" Tag="zh"/>
                                        </ComboBox>
                                    </Grid>
                                </StackPanel>

                                <!-- Tags -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="Inject Metadata Tags"
                                                  FontSize="14"/>
                                        <TextBlock Text="Add title, author, and thumbnail to files"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1"
                                                 IsChecked="{Binding Settings.ShouldInjectTags, Mode=TwoWay}"
                                                 VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>

                            <Separator Background="{DynamicResource MaterialDesignDivider}"/>

                            <!-- Behavior Settings -->
                            <StackPanel Spacing="16">
                                <TextBlock Text="Behavior"
                                          FontSize="14"
                                          FontWeight="Medium"/>

                                <!-- Auto-start Downloads -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="Auto-start Downloads"
                                                  FontSize="14"/>
                                        <TextBlock Text="Start downloads immediately after adding to queue"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1"
                                                 IsChecked="{Binding Settings.AutoStartDownload, Mode=TwoWay}"
                                                 VerticalAlignment="Center"/>
                                </Grid>

                                <!-- Open Folder After Download -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="Open Folder After Download"
                                                  FontSize="14"/>
                                        <TextBlock Text="Open containing folder when download completes"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1"
                                                 IsChecked="{Binding Settings.OpenFolderAfterDownload, Mode=TwoWay}"
                                                 VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>

                            <Separator Background="{DynamicResource MaterialDesignDivider}"/>

                            <!-- Download Location -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Storage"
                                          FontSize="14"
                                          FontWeight="Medium"/>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Default Download Location"
                                              FontSize="14"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0"
                                                x:Name="DownloadLocationTextBox"
                                                Text="{Binding Settings.DefaultDownloadPath, Mode=TwoWay}"
                                                Watermark="Select default download folder..."
                                                Theme="{DynamicResource MaterialFilledTextBox}"
                                                Margin="0,0,8,0"/>
                                        <Button Grid.Column="1"
                                               x:Name="BrowseLocationButton"
                                               Content="Browse"
                                               Command="{Binding BrowseDefaultLocationCommand}"
                                               Theme="{DynamicResource MaterialOutlineButton}"
                                               VerticalAlignment="Stretch"/>
                                    </Grid>
                                    <TextBlock Text="{Binding ActualDownloadPath, StringFormat='Current: {0}'}"
                                              FontSize="11"
                                              Foreground="{DynamicResource MaterialDesignBodyLight}"
                                              TextWrapping="Wrap"
                                              Margin="0,4,0,0"/>
                                </StackPanel>

                                <StackPanel Spacing="4" Margin="0,8,0,0">
                                    <TextBlock Text="Cache Location"
                                              FontSize="14"/>
                                    <Grid ColumnDefinitions="*,Auto,Auto">
                                        <TextBox Grid.Column="0"
                                                x:Name="CacheLocationTextBox"
                                                Text="{Binding Settings.DefaultCachePath, Mode=TwoWay}"
                                                Watermark="Select cache folder (empty = default)..."
                                                Theme="{DynamicResource MaterialFilledTextBox}"
                                                Margin="0,0,8,0"/>
                                        <Button Grid.Column="1"
                                               x:Name="BrowseCacheLocationButton"
                                               Content="Browse"
                                               Command="{Binding BrowseCacheLocationCommand}"
                                               Theme="{DynamicResource MaterialOutlineButton}"
                                               VerticalAlignment="Stretch"
                                               Margin="0,0,8,0"/>
                                        <Button Grid.Column="2"
                                               x:Name="ResetCacheLocationButton"
                                               Content="Reset"
                                               Command="{Binding ResetCacheLocationCommand}"
                                               Theme="{DynamicResource MaterialOutlineButton}"
                                               VerticalAlignment="Stretch"/>
                                    </Grid>
                                    <TextBlock Text="{Binding ActualCachePath, StringFormat='Current: {0}'}"
                                              FontSize="11"
                                              Foreground="{DynamicResource MaterialDesignBodyLight}"
                                              TextWrapping="Wrap"
                                              Margin="0,4,0,0"/>
                                    <TextBlock Text="⚠️ Application restart required for cache location changes to take effect"
                                              FontSize="11"
                                              Foreground="#F9A825"
                                              TextWrapping="Wrap"
                                              Margin="0,4,0,0"/>
                                </StackPanel>
                            </StackPanel>

                        </StackPanel>
                    </Border>
                </TabItem>

                <!-- Advanced Tab -->
                <TabItem Header="Advanced">
                    <Border Padding="20,16">
                        <StackPanel Spacing="16">

                            <!-- Language Specific Audio -->
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel Grid.Column="0" Spacing="4">
                                    <TextBlock Text="Language-Specific Audio Streams"
                                              FontSize="14"/>
                                    <TextBlock Text="Download audio in specific languages when available"
                                              FontSize="12"
                                              Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                </StackPanel>
                                <ToggleSwitch Grid.Column="1"
                                             IsChecked="{Binding Settings.ShouldInjectLanguageSpecificAudioStreams, Mode=TwoWay}"
                                             VerticalAlignment="Center"/>
                            </Grid>

                            <Separator Background="{DynamicResource MaterialDesignDivider}"/>

                            <!-- Cache Management -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Cache Management"
                                          FontSize="14"
                                          FontWeight="Medium"/>
                                <Border Background="{DynamicResource MaterialDesignCardBackground}"
                                        BorderBrush="{DynamicResource MaterialDesignDivider}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="16">
                                    <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="12">
                                        <TextBlock Grid.Row="0"
                                                  Text="{Binding CacheSize, StringFormat='Cache Size: {0}'}"
                                                  FontSize="14"/>
                                        <TextBlock Grid.Row="1"
                                                  Text="Cached video metadata helps improve performance"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                  TextWrapping="Wrap"/>
                                        <Button Grid.Row="2"
                                               x:Name="ClearCacheButton"
                                               Content="Clear Cache"
                                               Command="{Binding ClearCacheCommand}"
                                               Theme="{DynamicResource MaterialOutlineButton}"
                                               HorizontalAlignment="Left"/>
                                    </Grid>
                                </Border>
                            </StackPanel>

                            <Separator Background="{DynamicResource MaterialDesignDivider}"/>

                            <!-- Reset Settings Section -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Reset"
                                          FontSize="14"
                                          FontWeight="Medium"/>
                                <Border Background="{DynamicResource MaterialDesignCardBackground}"
                                        BorderBrush="{DynamicResource MaterialDesignDivider}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="16">
                                    <StackPanel Spacing="12">
                                        <TextBlock Text="Reset all settings to their default values"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                  TextWrapping="Wrap"/>
                                        <Button x:Name="ResetAllSettingsButton"
                                               Content="Reset All Settings to Default"
                                               Command="{Binding ResetAllSettingsCommand}"
                                               Theme="{DynamicResource MaterialOutlineButton}"
                                               HorizontalAlignment="Left"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <Separator Background="{DynamicResource MaterialDesignDivider}"/>

                            <!-- About Section -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="About"
                                          FontSize="14"
                                          FontWeight="Medium"/>
                                <Border Background="{DynamicResource MaterialDesignCardBackground}"
                                        BorderBrush="{DynamicResource MaterialDesignDivider}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="16">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Enhanced YouTube Downloader"
                                                  FontSize="14"
                                                  FontWeight="Medium"/>
                                        <TextBlock Text="Version 0.3.8"
                                                  FontSize="13"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                        <TextBlock Text="Built with .NET 9.0 and Avalonia UI"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                        </StackPanel>
                    </Border>
                </TabItem>

            </TabControl>
            </ScrollViewer>

            <!-- Action Buttons -->
            <Border Grid.Row="2"
                    Background="{DynamicResource MaterialDesignCardBackground}"
                    BorderBrush="{DynamicResource MaterialDesignDivider}"
                    BorderThickness="0,1,0,0"
                    Padding="20,14">
                <StackPanel Orientation="Horizontal"
                           HorizontalAlignment="Right"
                           Spacing="12">
                    <Button Content="Cancel"
                           Command="{Binding CancelCommand}"
                           Theme="{DynamicResource MaterialOutlineButton}"
                           MinWidth="100"/>
                    <Button Content="Save"
                           Command="{Binding SaveCommand}"
                           Theme="{DynamicResource MaterialOutlineButton}"
                           MinWidth="100"/>
                </StackPanel>
            </Border>

        </Grid>
    </Border>

</UserControl>
